# **Auth API - Supabase + JWT + TypeScript**

API de autenticaÃ§Ã£o construÃ­da em **Node.js + Express + TypeScript**, utilizando **Supabase** como banco de dados e **JWT** para autenticaÃ§Ã£o.  
Permite a gestÃ£o de usuÃ¡rios (admin/cliente), login seguro, reset de senha em duas etapas e envio de emails via **SMTP customizado**.

---

## ğŸš€ Tecnologias Utilizadas
- [Node.js](https://nodejs.org/)
- [Express](https://expressjs.com/)
- [TypeScript](https://www.typescriptlang.org/)
- [Supabase](https://supabase.com/)
- [JWT (jsonwebtoken)](https://github.com/auth0/node-jsonwebtoken)
- [bcryptjs](https://github.com/dcodeIO/bcrypt.js)
- [Nodemailer](https://nodemailer.com/)
- [dotenv](https://github.com/motdotla/dotenv)

---

## ğŸ“‚ Estrutura do Projeto
```bash
src/
  controllers/        # Controladores (HTTP)
    authController.ts
    adminController.ts
    clientController.ts

  services/           # LÃ³gica de negÃ³cio
    authService.ts
    userService.ts

  middlewares/        # Middlewares de autenticaÃ§Ã£o/autorizaÃ§Ã£o
    isAuth.ts
    isAdmin.ts

  routes/             # DefiniÃ§Ã£o de rotas
    authRoutes.ts
    adminRoutes.ts
    clientRoutes.ts

  utils/              # FunÃ§Ãµes auxiliares
    supabaseClient.ts
    jwt.ts
    generatePassword.ts
    sendEmail.ts

  index.ts            # Ponto de entrada da aplicaÃ§Ã£o
```
---

## âš™ï¸ ConfiguraÃ§Ã£o do Banco (Supabase)
Crie as tabelas no Supabase:

```
create table users (
    id uuid primary key default gen_random_uuid(),
    email text not null unique,
    password_hash text not null,
    role text not null check (role in ('admin', 'cliente')),
    created_at timestamp default now(),
    updated_at timestamp default now()
);

create table password_resets (
    id uuid primary key default gen_random_uuid(),
    email text not null,
    code text not null,
    expires_at timestamp not null,
    used boolean default false,
    created_at timestamp default now()
);
```

---

## ğŸ”‘ VariÃ¡veis de Ambiente
Crie um arquivo .env na raiz:

```
PORT=4000
JWT_SECRET=supersecretaqui
SUPABASE_URL=https://xxxx.supabase.co
SUPABASE_KEY=chave_supabase_aqui

SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seuemail@gmail.com
SMTP_PASS=sua_senha_de_app
```
---

## â–¶ï¸ Executando o Projeto

1. Instalar dependÃªncias
```bash
npm install
```

2. Rodar em modo desenvolvimento
```bash
npm run dev
```

3. Build para produÃ§Ã£o
```bash
npm run build
npm start
```

---

## ğŸ“¬ Rotas da API

### AutenticaÃ§Ã£o
```
- POST /auth/login
- POST /auth/reset/request
- POST /auth/reset/verify
- POST /auth/reset/confirm
```

### Admin
```
- POST /admin/cadastrar
```

### Cliente
```
- GET /cliente
```

---

## ğŸ“§ Envio de Emails
- Cadastro â†’ envia email de boas-vindas com senha inicial.
- Reset de senha â†’ envia cÃ³digo de verificaÃ§Ã£o para o email.

---

## ğŸ§ª Testes no Postman
```
- AuthAPI.postman_collection.json
- AuthAPI.postman_environment.json
```
---

## ğŸ‘¨â€ğŸ’» Autor
Desenvolvido por **Yuri Henrique**
ğŸ“§ Email: yurihcs@al.insper.edu.br
ğŸŒ GitHub: https://github.com/Uyris